!function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AFRAME.THREE.FileLoader;return new Ie(function(n,r){e.load(t,n,function(){},r)})}function r(){function t(t,e){console.log("Attempting to get controllers"),(He=altspace.getGamepads()).length>0?(console.log("Got controllers"),t(He.filter(function(t){return!!t.hand}))):e()}function e(t,e){function n(){r.removeEventListener("click",n),t()}var r=document.querySelector("a-scene");console.log("waiting for focus"),r.addEventListener("click",n)}function n(e){return new Ie(t).catch(function(){if(--e>0)return new Ie(function(t,e){return setTimeout(t,500)}).then(function(){return n(e)});console.log("Failed to get controllers")})}return altspace.inClient?new Ie(t).catch(function(){return new Ie(e)}).then(function(){return n(20)}):Ie.reject()}var i=e(function(t){!function(e){function n(t,e,n,o){var a=e&&e.prototype instanceof i?e:i,s=Object.create(a.prototype),u=new h(o||[]);return s._invoke=function(t,e,n){var i=x;return function(o,a){if(i===L)throw new Error("Generator is already running");if(i===S){if("throw"===o)throw a;return d()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=c(s,n);if(u){if(u===k)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===x)throw i=S,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=L;var l=r(t,e,n);if("normal"===l.type){if(i=n.done?S:A,l.arg===k)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=S,n.method="throw",n.arg=l.arg)}}}(t,n,u),s}function r(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function o(){}function a(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){function e(n,i,o,a){var s=r(t[n],t,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(c).then(function(t){u.value=t,o(u)},a)}a(s.arg)}var n;this._invoke=function(t,r){function i(){return new Promise(function(n,i){e(t,r,n,i)})}return n=n?n.then(i,i):i()}}function c(t,e){var n=t.iterator[e.method];if(n===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,c(t,e),"throw"===e.method))return k;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var i=r(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,k;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,k):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,k)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function p(t){if(t){var e=t[b];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(y.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return r.next=r}}return{next:d}}function d(){return{value:v,done:!0}}var v,g=Object.prototype,y=g.hasOwnProperty,m="function"==typeof Symbol?Symbol:{},b=m.iterator||"@@iterator",w=m.asyncIterator||"@@asyncIterator",_=m.toStringTag||"@@toStringTag",E=e.regeneratorRuntime;if(E)t.exports=E;else{(E=e.regeneratorRuntime=t.exports).wrap=n;var x="suspendedStart",A="suspendedYield",L="executing",S="completed",k={},j={};j[b]=function(){return this};var M=Object.getPrototypeOf,O=M&&M(M(p([])));O&&O!==g&&y.call(O,b)&&(j=O);var T=a.prototype=i.prototype=Object.create(j);o.prototype=T.constructor=a,a.constructor=o,a[_]=o.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(T),t},E.awrap=function(t){return{__await:t}},s(u.prototype),u.prototype[w]=function(){return this},E.AsyncIterator=u,E.async=function(t,e,r,i){var o=new u(n(t,e,r,i));return E.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},s(T),T[_]="Generator",T[b]=function(){return this},T.toString=function(){return"[object Generator]"},E.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},E.values=p,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&y.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=y.call(i,"catchLoc"),s=y.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&y.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,k):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),k},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),k}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;f(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:p(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),k}}}}(function(){return this}()||Function("return this")())}),o=function(){return this}()||Function("return this")(),a=o.regeneratorRuntime&&Object.getOwnPropertyNames(o).indexOf("regeneratorRuntime")>=0,s=a&&o.regeneratorRuntime;o.regeneratorRuntime=void 0;var u=i;if(a)o.regeneratorRuntime=s;else try{delete o.regeneratorRuntime}catch(t){o.regeneratorRuntime=void 0}var c=u,l=Math.ceil,f=Math.floor,h=function(t){return isNaN(t=+t)?0:(t>0?f:l)(t)},p=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},d=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),v=e(function(t){var e=t.exports={version:"2.5.1"};"number"==typeof __e&&(__e=e)}),g=(v.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),y=function(t,e,n){if(g(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},m=function(t){return"object"==typeof t?null!==t:"function"==typeof t},b=function(t){if(!m(t))throw TypeError(t+" is not an object!");return t},w=function(t){try{return!!t()}catch(t){return!0}},_=!w(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),E=d.document,x=m(E)&&m(E.createElement),A=function(t){return x?E.createElement(t):{}},L=!_&&!w(function(){return 7!=Object.defineProperty(A("div"),"a",{get:function(){return 7}}).a}),S=Object.defineProperty,k={f:_?Object.defineProperty:function(t,e,n){if(b(t),e=function(t,e){if(!m(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!m(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!m(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!m(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),b(n),L)try{return S(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},j=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},M=_?function(t,e,n){return k.f(t,e,j(1,n))}:function(t,e,n){return t[e]=n,t},O="prototype",T=function(t,e,n){var r,i,o,a=t&T.F,s=t&T.G,u=t&T.S,c=t&T.P,l=t&T.B,f=t&T.W,h=s?v:v[e]||(v[e]={}),p=h[O],g=s?d:u?d[e]:(d[e]||{})[O];s&&(n=e);for(r in n)(i=!a&&g&&void 0!==g[r])&&r in h||(o=i?g[r]:n[r],h[r]=s&&"function"!=typeof g[r]?n[r]:l&&i?y(o,d):f&&g[r]==o?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[O]=t[O],e}(o):c&&"function"==typeof o?y(Function.call,o):o,c&&((h.virtual||(h.virtual={}))[r]=o,t&T.R&&p&&!p[r]&&M(p,r,o)))};T.F=1,T.G=2,T.S=4,T.P=8,T.B=16,T.W=32,T.U=64,T.R=128;var P=T,R=M,F={}.hasOwnProperty,C=function(t,e){return F.call(t,e)},D={},B={}.toString,N=function(t){return B.call(t).slice(8,-1)},G=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==N(t)?t.split(""):Object(t)},z=function(t){return G(p(t))},I=Math.min,W=function(t){return t>0?I(h(t),9007199254740991):0},H=Math.max,V=Math.min,q="__core-js_shared__",K=d[q]||(d[q]={}),Q=function(t){return K[t]||(K[t]={})},J=0,U=Math.random(),Y=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++J+U).toString(36))},X=Q("keys"),Z=function(t){return X[t]||(X[t]=Y(t))},$=function(t){return function(e,n,r){var i,o=z(e),a=W(o.length),s=function(t,e){return(t=h(t))<0?H(t+e,0):V(t,e)}(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}(!1),tt=Z("IE_PROTO"),et="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),nt=Object.keys||function(t){return function(t,e){var n,r=z(t),i=0,o=[];for(n in r)n!=tt&&C(r,n)&&o.push(n);for(;e.length>i;)C(r,n=e[i++])&&(~$(o,n)||o.push(n));return o}(t,et)},rt=_?Object.defineProperties:function(t,e){b(t);for(var n,r=nt(e),i=r.length,o=0;i>o;)k.f(t,n=r[o++],e[n]);return t},it=d.document,ot=it&&it.documentElement,at=Z("IE_PROTO"),st=function(){},ut="prototype",ct=function(){var t,e=A("iframe"),n=et.length;for(e.style.display="none",ot.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ct=t.F;n--;)delete ct[ut][et[n]];return ct()},lt=Object.create||function(t,e){var n;return null!==t?(st[ut]=b(t),n=new st,st[ut]=null,n[at]=t):n=ct(),void 0===e?n:rt(n,e)},ft=e(function(t){var e=Q("wks"),n=d.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:Y)("Symbol."+t))}).store=e}),ht=k.f,pt=ft("toStringTag"),dt=function(t,e,n){t&&!C(t=n?t:t.prototype,pt)&&ht(t,pt,{configurable:!0,value:e})},vt={};M(vt,ft("iterator"),function(){return this});var gt=function(t){return Object(p(t))},yt=Z("IE_PROTO"),mt=Object.prototype,bt=Object.getPrototypeOf||function(t){return t=gt(t),C(t,yt)?t[yt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?mt:null},wt=ft("iterator"),_t=!([].keys&&"next"in[].keys()),Et="values",xt=function(){return this},At=function(t,e,n,r,i,o,a){!function(t,e,n){t.prototype=lt(vt,{next:j(1,n)}),dt(t,e+" Iterator")}(n,e,r);var s,u,c,l=function(t){if(!_t&&t in d)return d[t];switch(t){case"keys":case Et:return function(){return new n(this,t)}}return function(){return new n(this,t)}},f=e+" Iterator",h=i==Et,p=!1,d=t.prototype,v=d[wt]||d["@@iterator"]||i&&d[i],g=v||l(i),y=i?h?l("entries"):g:void 0,m="Array"==e?d.entries||v:v;if(m&&(c=bt(m.call(new t)))!==Object.prototype&&c.next&&dt(c,f,!0),h&&v&&v.name!==Et&&(p=!0,g=function(){return v.call(this)}),a&&(_t||p||!d[wt])&&M(d,wt,g),D[e]=g,D[f]=xt,i)if(s={values:h?g:l(Et),keys:o?g:l("keys"),entries:y},a)for(u in s)u in d||R(d,u,s[u]);else P(P.P+P.F*(_t||p),e,s);return s},Lt=function(t){return function(e,n){var r,i,o=String(p(e)),a=h(n),s=o.length;return a<0||a>=s?t?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}(!0);At(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Lt(e,n),this._i+=t.length,{value:t,done:!1})});var St=function(t,e){return{value:e,done:!!t}};At(Array,"Array",function(t,e){this._t=z(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,St(1)):"keys"==e?St(0,n):"values"==e?St(0,t[n]):St(0,[n,t[n]])},"values");D.Arguments=D.Array;for(var kt=ft("toStringTag"),jt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Mt=0;Mt<jt.length;Mt++){var Ot=jt[Mt],Tt=d[Ot],Pt=Tt&&Tt.prototype;Pt&&!Pt[kt]&&M(Pt,kt,Ot),D[Ot]=D.Array}var Rt,Ft,Ct,Dt=ft("toStringTag"),Bt="Arguments"==N(function(){return arguments}()),Nt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Dt))?n:Bt?N(e):"Object"==(r=N(e))&&"function"==typeof e.callee?"Arguments":r},Gt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},zt=function(t,e,n,r){try{return r?e(b(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&b(i.call(t)),e}},It=ft("iterator"),Wt=Array.prototype,Ht=ft("iterator"),Vt=v.getIteratorMethod=function(t){if(void 0!=t)return t[Ht]||t["@@iterator"]||D[Nt(t)]},qt=e(function(t){var e={},n={},r=t.exports=function(t,r,i,o,a){var s,u,c,l,f=a?function(){return t}:Vt(t),h=y(i,o,r?2:1),p=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(function(t){return void 0!==t&&(D.Array===t||Wt[It]===t)}(f)){for(s=W(t.length);s>p;p++)if((l=r?h(b(u=t[p])[0],u[1]):h(t[p]))===e||l===n)return l}else for(c=f.call(t);!(u=c.next()).done;)if((l=zt(c,h,u.value,r))===e||l===n)return l};r.BREAK=e,r.RETURN=n}),Kt=ft("species"),Qt=function(t,e){var n,r=b(t).constructor;return void 0===r||void 0==(n=b(r)[Kt])?e:g(n)},Jt=d.process,Ut=d.setImmediate,Yt=d.clearImmediate,Xt=d.MessageChannel,Zt=d.Dispatch,$t=0,te={},ee="onreadystatechange",ne=function(){var t=+this;if(te.hasOwnProperty(t)){var e=te[t];delete te[t],e()}},re=function(t){ne.call(t.data)};Ut&&Yt||(Ut=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return te[++$t]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Rt($t),$t},Yt=function(t){delete te[t]},"process"==N(Jt)?Rt=function(t){Jt.nextTick(y(ne,t,1))}:Zt&&Zt.now?Rt=function(t){Zt.now(y(ne,t,1))}:Xt?(Ct=(Ft=new Xt).port2,Ft.port1.onmessage=re,Rt=y(Ct.postMessage,Ct,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(Rt=function(t){d.postMessage(t+"","*")},d.addEventListener("message",re,!1)):Rt=ee in A("script")?function(t){ot.appendChild(A("script"))[ee]=function(){ot.removeChild(this),ne.call(t)}}:function(t){setTimeout(y(ne,t,1),0)});var ie={set:Ut,clear:Yt},oe=ie.set,ae=d.MutationObserver||d.WebKitMutationObserver,se=d.process,ue=d.Promise,ce="process"==N(se),le={f:function(t){return new function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=g(e),this.reject=g(n)}(t)}},fe=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},he=function(t,e){if(b(t),m(e)&&e.constructor===t)return e;var n=le.f(t);return(0,n.resolve)(e),n.promise},pe=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:M(t,r,e[r]);return t},de=ft("species"),ve=function(t){var e="function"==typeof v[t]?v[t]:d[t];_&&e&&!e[de]&&k.f(e,de,{configurable:!0,get:function(){return this}})},ge=ft("iterator"),ye=!1;try{[7][ge]().return=function(){ye=!0}}catch(t){}var me,be,we,_e,Ee=ie.set,xe=function(){var t,e,n,r=function(){var r,i;for(ce&&(r=se.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(ce)n=function(){se.nextTick(r)};else if(ae){var i=!0,o=document.createTextNode("");new ae(r).observe(o,{characterData:!0}),n=function(){o.data=i=!i}}else if(ue&&ue.resolve){var a=ue.resolve();n=function(){a.then(r)}}else n=function(){oe.call(d,r)};return function(r){var i={fn:r,next:void 0};e&&(e.next=i),t||(t=i,n()),e=i}}(),Ae="Promise",Le=d.TypeError,Se=d.process,ke=d[Ae],je="process"==Nt(Se),Me=function(){},Oe=be=le.f,Te=!!function(){try{var t=ke.resolve(1),e=(t.constructor={})[ft("species")]=function(t){t(Me,Me)};return(je||"function"==typeof PromiseRejectionEvent)&&t.then(Me)instanceof e}catch(t){}}(),Pe=function(t){var e;return!(!m(t)||"function"!=typeof(e=t.then))&&e},Re=function(t,e){if(!t._n){t._n=!0;var n=t._c;xe(function(){for(var r=t._v,i=1==t._s,o=0,a=function(e){var n,o,a=i?e.ok:e.fail,s=e.resolve,u=e.reject,c=e.domain;try{a?(i||(2==t._h&&De(t),t._h=1),!0===a?n=r:(c&&c.enter(),n=a(r),c&&c.exit()),n===e.promise?u(Le("Promise-chain cycle")):(o=Pe(n))?o.call(n,s,u):s(n)):u(r)}catch(t){u(t)}};n.length>o;)a(n[o++]);t._c=[],t._n=!1,e&&!t._h&&Fe(t)})}},Fe=function(t){Ee.call(d,function(){var e,n,r,i=t._v,o=Ce(t);if(o&&(e=fe(function(){je?Se.emit("unhandledRejection",i,t):(n=d.onunhandledrejection)?n({promise:t,reason:i}):(r=d.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=je||Ce(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},Ce=function(t){if(1==t._h)return!1;for(var e,n=t._a||t._c,r=0;n.length>r;)if((e=n[r++]).fail||!Ce(e.promise))return!1;return!0},De=function(t){Ee.call(d,function(){var e;je?Se.emit("rejectionHandled",t):(e=d.onrejectionhandled)&&e({promise:t,reason:t._v})})},Be=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Re(e,!0))},Ne=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Le("Promise can't be resolved itself");(e=Pe(t))?xe(function(){var r={_w:n,_d:!1};try{e.call(t,y(Ne,r,1),y(Be,r,1))}catch(t){Be.call(r,t)}}):(n._v=t,n._s=1,Re(n,!1))}catch(t){Be.call({_w:n,_d:!1},t)}}};Te||(ke=function(t){Gt(this,ke,Ae,"_h"),g(t),me.call(this);try{t(y(Ne,this,1),y(Be,this,1))}catch(t){Be.call(this,t)}},(me=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=pe(ke.prototype,{then:function(t,e){var n=Oe(Qt(this,ke));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=je?Se.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Re(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),we=function(){var t=new me;this.promise=t,this.resolve=y(Ne,t,1),this.reject=y(Be,t,1)},le.f=Oe=function(t){return t===ke||t===_e?new we(t):be(t)}),P(P.G+P.W+P.F*!Te,{Promise:ke}),dt(ke,Ae),ve(Ae),_e=v[Ae],P(P.S+P.F*!Te,Ae,{reject:function(t){var e=Oe(this);return(0,e.reject)(t),e.promise}}),P(P.S+!0*P.F,Ae,{resolve:function(t){return he(this===_e?ke:this,t)}}),P(P.S+P.F*!(Te&&function(t,e){if(!e&&!ye)return!1;var n=!1;try{var r=[7],i=r[ge]();i.next=function(){return{done:n=!0}},r[ge]=function(){return i},t(r)}catch(t){}return n}(function(t){ke.all(t).catch(Me)})),Ae,{all:function(t){var e=this,n=Oe(e),r=n.resolve,i=n.reject,o=fe(function(){var n=[],o=0,a=1;qt(t,!1,function(t){var s=o++,u=!1;n.push(void 0),a++,e.resolve(t).then(function(t){u||(u=!0,n[s]=t,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(t){var e=this,n=Oe(e),r=n.reject,i=fe(function(){qt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}}),P(P.P+P.R,"Promise",{finally:function(t){var e=Qt(this,v.Promise||d.Promise),n="function"==typeof t;return this.then(n?function(n){return he(e,t()).then(function(){return n})}:t,n?function(n){return he(e,t()).then(function(){throw n})}:t)}}),P(P.S,"Promise",{try:function(t){var e=le.f(this),n=fe(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var Ge=v.Promise,ze=e(function(t){t.exports={default:Ge,__esModule:!0}}),Ie=t(ze),We=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(ze);e.default=function(t){return function(){var e=t.apply(this,arguments);return new n.default(function(t,r){function i(o,a){try{var s=e[o](a),u=s.value}catch(t){return void r(t)}if(!s.done)return n.default.resolve(u).then(function(t){i("next",t)},function(t){i("throw",t)});t(u)}return i("next")})}}}));AFRAME.registerComponent("place-for-space",{schema:{templates:{default:[]},mixins:{default:[]},otherwise:{default:""}},init:function(){var t=We(c.mark(function t(){var e,n;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!altspace.inClient){t.next=6;break}return t.next=3,altspace.getSpace();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0={};case 7:e=t.t0,console.log(e),(n=this.data.templates.indexOf(e.templateSid))>=0?this.el.setAttribute("mixin",this.data.mixins[n]):this.el.setAttribute("mixin",this.data.otherwise);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-page",{schema:{service:{type:"string",default:"poly"},page:{type:"int",default:0}},update:function(){var t=We(c.mark(function t(e){return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.el.emit("pageupdatestart"),t.prev=1,t.next=4,this.el.sceneEl.systems[this.data.service+"-service"].fakeGetListing(this.data.page);case 4:this.currentPage=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),console.error(t.t0.stack);case 10:this.el.emit("pageupdateend");case 11:case"end":return t.stop()}},t,this,[[1,7]])}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-item",{schema:{type:"int"},init:function(){this.itemData=null,this.el.parentElement.addEventListener("pageupdatestart",this.showLoading.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updateContents.bind(this)),this.el.addEventListener("materialtextureloaded",this.updateDimensions.bind(this)),this.el.addEventListener("click",this.previewModel.bind(this))},showLoading:function(){this.el.setAttribute("color","#555")},updateContents:function(){this.itemData=this.el.parentElement.components["library-page"].currentPage.assets[this.data],this.itemData&&this.el.setAttribute("src",this.itemData.thumbnail.url)},updateDimensions:function(){var t=this.el.object3DMap.mesh.material.map,e=t?t.image:{width:1,height:1},n=e.width/e.height;n>1?this.el.setAttribute("scale",{x:1,y:1/n,z:1}):this.el.setAttribute("scale",{x:n,y:1,z:1}),this.itemData&&this.el.setAttribute("color","#fff")},previewModel:function(){var t=document.querySelector("#spawn_point"),e=this.itemData.formats.filter(function(t){return"GLTF2"===t.formatType});t.setAttribute("src",e[0].root.url)}}),AFRAME.registerComponent("library-advance",{schema:{type:"int"},init:function(){this.active=!1,this.el.addEventListener("click",this.advance.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updatePaging.bind(this))},advance:function(){if(this.active){var t=this.el.parentElement,e=t.getAttribute("library-page").page;t.setAttribute("library-page","page",e+this.data)}},updatePaging:function(){var t=this.el.parentElement.components["library-page"];this.el.sceneEl.systems["poly-service"].pages[t.data.page+this.data]||this.data>0&&t.currentPage.nextPageToken?(this.el.setAttribute("avr-visible",!0),this.active=!0,console.log("advance "+this.data+": shown")):(this.el.setAttribute("avr-visible",!1),this.active=!1,console.log("advance "+this.data+": hidden"))}}),AFRAME.registerSystem("poly-service",{schema:{key:{type:"string"}},init:function(){this.pages=[],this.loader=new AFRAME.THREE.FileLoader,this.query="https://poly.googleapis.com/v1/assets/?format=GLTF2&maxComplexity=SIMPLE&pageSize=20&key="+this.data.key},getListing:function(){var t=We(c.mark(function t(e){var r,i,o,a,s;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("attemping grab of page",e),!(e<0)){t.next=3;break}throw new Error("Requested page ("+e+") before beginning");case 3:if(!this.pages[e]){t.next=7;break}return t.abrupt("return",this.pages[e]);case 7:if(0!==e){t.next=16;break}return t.next=10,n(this.query,this.loader);case 10:return r=t.sent,i=JSON.parse(r),this.pages.push(i),t.abrupt("return",i);case 16:return o={},t.prev=17,t.next=20,this.getListing(e-1);case 20:o=t.sent,t.next=27;break;case 23:throw t.prev=23,t.t0=t.catch(17),console.log(t.t0.stack),new Error("Requested page ("+e+") past end, no previous page");case 27:if(!o.nextPageToken){t.next=36;break}return t.next=30,n(this.query+"&pageToken="+o.nextPageToken,this.loader);case 30:return a=t.sent,s=JSON.parse(a),this.pages.push(s),t.abrupt("return",s);case 36:throw new Error("Requested page ("+e+") past end, no page token");case 37:case"end":return t.stop()}},t,this,[[17,23]])}));return function(e){return t.apply(this,arguments)}}(),fakeGetListing:function(){var t=We(c.mark(function t(e){var r;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n("testdata/listing.json",this.loader);case 2:return r=t.sent,t.abrupt("return",JSON.parse(r));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("avr-visible",{schema:{type:"boolean",default:!1},init:function(){this.el.addEventListener("model-loaded",this.update.bind(this))},update:function(){var t=this;console.log("visible update:",this.data),this.el.object3D.traverse(function(e){return e.visible=t.data})}});AFRAME.registerComponent("hover-scale",{init:function(){var t=this;this.el.setAttribute("animation__hover",{startEvents:["hoverstart","mouseleave"],property:"scale",dir:"alternate",easing:"easeOutQuad",dur:200}),this.el.addEventListener("mouseenter",function(){var e=function(t,e){return e.map(function(e){return t[e]})}(t.el.getAttribute("scale"),["x","y","z"]),n=e.map(function(t){return 1.2*t});t.el.setAttribute("animation__hover",{from:e.join(" "),to:n.join(" ")}),t.el.emit("hoverstart")})}}),AFRAME.registerComponent("maintain-size",{schema:{type:"vec3"},init:function(){this.el.addEventListener("model-loaded",this.rescale.bind(this))},rescale:function(){this.el.setAttribute("position",{x:0,y:0,z:0}),this.el.setAttribute("scale",{x:1,y:1,z:1});var t=new AFRAME.THREE.Box3;t.setFromObject(this.el.object3D);var e=t.getSize(),n=t.getCenter().sub(this.el.object3D.getWorldPosition()),r=Math.min(this.data.x/e.x,this.data.y/e.y,this.data.z/e.z);this.el.setAttribute("scale",{x:r,y:r,z:r}),this.el.setAttribute("position",n.multiplyScalar(-r))}});var He=[],Ve=null;AFRAME.registerComponent("altspace-controls",{schema:{default:"right"},init:function(){var t=We(c.mark(function t(){var e,n=this;return c.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.gamepad=null,this.parentInverse=(new THREE.Matrix4).getInverse(this.el.parentElement.object3D.matrixWorld),Ve||(Ve=r()),!(He.length>0)){t.next=7;break}t.t0=He,t.next=10;break;case 7:return t.next=9,Ve;case 9:t.t0=t.sent;case 10:e=t.t0,this.gamepad=e.filter(function(t){return t.hand===n.data})[0],this.gamepad||console.log("No "+this.data+"-hand controller found");case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tick:function(){this.gamepad&&(this.el.object3D.position.copy(this.gamepad.position).applyMatrix4(this.parentInverse),this.el.object3D.quaternion.copy(this.gamepad.rotation),!this.gripState&&this.gamepad.buttons[1].pressed?(this.gripState=!0,this.el.emit("gripdown",this.el,!1)):this.gripState&&!this.gamepad.buttons[1].pressed&&(this.gripState=!1,this.el.emit("gripup",this.el,!1)))}}),AFRAME.registerComponent("grabbable",{schema:{by:{type:"selectorAll"}},init:function(){var t=this;this.bounds=new AFRAME.THREE.Box3,this.el.addEventListener("model-loaded",this.updateBounds.bind(this)),this._pickup=this.pickup.bind(this),this._drop=this.drop.bind(this),this.el.addEventListener("beginContact",function(){return t.el.setAttribute("color","red")}),this.el.addEventListener("endContact",function(){return t.el.setAttribute("color","green")})},tick:function(){},pickup:function(){},drop:function(){},updateBounds:function(){this.bounds.setFromObject(this.el.object3D),this.bounds.applyMatrix4((new THREE.Matrix4).getInverse(this.el.object3D.matrixWorld))}});var qe=e(function(t){var e=Y("meta"),n=k.f,r=0,i=Object.isExtensible||function(){return!0},o=!w(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!m(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!C(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!C(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!C(t,e)&&a(t),t}}}),Ke=(qe.KEY,qe.NEED,qe.fastKey,qe.getWeak,qe.onFreeze,function(t,e){if(!m(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}),Qe=k.f,Je=qe.fastKey,Ue=_?"_s":"size",Ye=function(t,e){var n,r=Je(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n},Xe={getConstructor:function(t,e,n,r){var i=t(function(t,o){Gt(t,i,e,"_i"),t._t=e,t._i=lt(null),t._f=void 0,t._l=void 0,t[Ue]=0,void 0!=o&&qt(o,n,t[r],t)});return pe(i.prototype,{clear:function(){for(var t=Ke(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[Ue]=0},delete:function(t){var n=Ke(this,e),r=Ye(n,t);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[Ue]--}return!!r},forEach:function(t){Ke(this,e);for(var n,r=y(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!Ye(Ke(this,e),t)}}),_&&Qe(i.prototype,"size",{get:function(){return Ke(this,e)[Ue]}}),i},def:function(t,e,n){var r,i,o=Ye(t,e);return o?o.v=n:(t._l=o={i:i=Je(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=o),r&&(r.n=o),t[Ue]++,"F"!==i&&(t._i[i]=o)),t},getEntry:Ye,setStrong:function(t,e,n){At(t,e,function(t,n){this._t=Ke(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?"keys"==t?St(0,e.k):"values"==t?St(0,e.v):St(0,[e.k,e.v]):(this._t=void 0,St(1))},n?"entries":"values",!n,!0),ve(e)}},Ze=Array.isArray||function(t){return"Array"==N(t)},$e=ft("species"),tn=function(t,e){return new(function(t){var e;return Ze(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Ze(e.prototype)||(e=void 0),m(e)&&null===(e=e[$e])&&(e=void 0)),void 0===e?Array:e}(t))(e)},en=k.f,nn=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,u=e||tn;return function(e,c,l){for(var f,h,p=gt(e),d=G(p),v=y(c,l,3),g=W(d.length),m=0,b=n?u(e,g):r?u(e,0):void 0;g>m;m++)if((s||m in d)&&(f=d[m],h=v(f,m,p),t))if(n)b[m]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return m;case 2:b.push(f)}else if(o)return!1;return a?-1:i||o?o:b}}(0);!function(t,e,n,r,i,o){var a=d[t],s=a,u=i?"set":"add",c=s&&s.prototype,l={};_&&"function"==typeof s&&(o||c.forEach&&!w(function(){(new s).entries().next()}))?(s=e(function(e,n){Gt(e,s,t,"_c"),e._c=new a,void 0!=n&&qt(n,i,e[u],e)}),nn("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in c&&(!o||"clear"!=t)&&M(s.prototype,t,function(n,r){if(Gt(this,s,t),!e&&o&&!m(n))return"get"==t&&void 0;var i=this._c[t](0===n?0:n,r);return e?this:i})}),o||en(s.prototype,"size",{get:function(){return this._c.size}})):(s=r.getConstructor(e,t,i,u),pe(s.prototype,n),qe.NEED=!0),dt(s,t),l[t]=s,P(P.G+P.W+P.F,l),o||r.setStrong(s,t,i)}("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=Xe.getEntry(Ke(this,"Map"),t);return e&&e.v},set:function(t,e){return Xe.def(Ke(this,"Map"),0===t?0:t,e)}},Xe,!0);P(P.P+P.R,"Map",{toJSON:function(t){return function(){if(Nt(this)!=t)throw TypeError(t+"#toJSON isn't generic");return function(t,e){var n=[];return qt(t,!1,n.push,n,e),n}(this)}}("Map")});!function(t){P(P.S,t,{of:function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return new this(e)}})}("Map");!function(t){P(P.S,t,{from:function(t){var e,n,r,i,o=arguments[1];return g(this),(e=void 0!==o)&&g(o),void 0==t?new this:(n=[],e?(r=0,i=y(o,arguments[2],2),qt(t,!1,function(t){n.push(i(t,r++))})):qt(t,!1,n.push,n),new this(n))}})}("Map");var rn=v.Map,on=t(e(function(t){t.exports={default:rn,__esModule:!0}})),an=t(e(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}));P(P.S+P.F*!_,"Object",{defineProperty:k.f});var sn=v.Object,un=function(t,e,n){return sn.defineProperty(t,e,n)},cn=e(function(t){t.exports={default:un,__esModule:!0}});t(cn);var ln=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(cn);e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(t,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()})),fn=function(){function t(){an(this,t),this.aToB=new on,this.bToA=new on}return ln(t,[{key:"set",value:function(t,e){var n=this.bToA.get(e),r=this.aToB.get(t);n===t&&r===e||(this.aToB.delete(n),this.bToA.delete(r)),this.aToB.set(t,e),this.bToA.set(e,t)}},{key:"getB",value:function(t){return this.aToB.get(t)}},{key:"getA",value:function(t){return this.bToA.get(t)}},{key:"forEach",value:function(t){return this.bToA.forEach(t)}}]),t}();AFRAME.registerSystem("collision",{init:function(){var t=this;this.el2co=new fn,this.el2localBounds=new on,this._regQueue=[],this._step=0,Ammo().then(function(){var e=new Ammo.btDefaultCollisionConfiguration,n=new Ammo.btCollisionDispatcher(e),r=new Ammo.btAxisSweep3(new Ammo.btVector3(-100,-100,-100),new Ammo.btVector3(100,100,100));t.world=new Ammo.btCollisionWorld(n,r,e),t._regQueue.forEach(function(e){return t.registerCollisionBody(e)}),t._regQueue=null})},tick:function(){var t=this;if(this.world){this.el2co.forEach(function(e,n){if(e.getAttribute("collision").kinematic){var r=t.el2localBounds.get(e),i=e.object3D.localToWorld(r.getCenter()),o=e.object3D.getWorldQuaternion(),a=e.object3D.getWorldScale(),s=n.getWorldTransform(),u=n.getCollisionShape();s.getOrigin().setValue(i.x,i.y,i.z),s.setRotation(new Ammo.btQuaternion(o.x,o.y,o.z,o.w)),u.setLocalScaling(new Ammo.btVector3(a.x,a.y,a.z))}}),this.world.stepSimulation(this._step++);for(var e=this.world.getDispatcher(),n=e.getNumManifolds(),r=0;r<n;r++){var i=e.getManifoldByIndexInternal(r),o=i.getBody0(),a=i.getBody1(),s=this.el2co.getA(o),u=this.el2co.getA(a);s.getAttribute("collision").with.includes(u)&&u.getAttribute("collision").with.includes(s)&&(console.log("fire event!"),u.dispatchEvent("collision-start",s,!1),s.dispatchEvent("collision-start",u,!1))}}},registerCollisionBody:function(t){if(this.world){var e=new AFRAME.THREE.Box3;e.setFromObject(t.object3DMap.mesh);var n=(new THREE.Matrix4).getInverse(t.object3D.matrixWorld);e.applyMatrix4(n),this.el2localBounds.set(t,e);var r=e.getSize(),i=new Ammo.btVector3(r.x/2,r.y/2,r.z/2),o=new Ammo.btCollisionObject;o.setCollisionShape(new Ammo.btBoxShape(i)),this.el2co.set(t,o),this.world.addCollisionObject(o)}else this._regQueue.push(t)},removeCollisionBody:function(t){},isRegistered:function(t){return!!this.el2co.getB(t)}}),AFRAME.registerComponent("collision",{schema:{with:{type:"selectorAll"},kinematic:{type:"boolean",default:!1}},init:function(){this.el.object3DMap.mesh&&this.updateBounds(),this.el.addEventListener("model-loaded",this.updateBounds.bind(this))},updateBounds:function(){this.system.isRegistered(this.el)&&this.system.removeCollisionBody(this.el),this.system.registerCollisionBody(this.el)},remove:function(){this.system.removeCollisionBody(this.el)}})}();
//# sourceMappingURL=bundle.min.js.map
//# sourceMappingURL=bundle.min.js.map
