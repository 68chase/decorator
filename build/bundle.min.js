!function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AFRAME.THREE.FileLoader;return new Ve(function(n,r){e.load(t,n,function(){},r)})}function r(t,e){var n=new dn(t),r=!0,i=!1,o=void 0;try{for(var a,s=Je(e);!(r=(a=s.next()).done);r=!0){var u=a.value;n.delete(u)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}function i(){function t(t,e){console.log("Attempting to get controllers"),(pn=altspace.getGamepads()).length>0?(console.log("Got controllers"),t(pn.filter(function(t){return!!t.hand}))):e()}function e(t,e){function n(){r.removeEventListener("click",n),t()}var r=document.querySelector("a-scene");console.log("waiting for focus"),r.addEventListener("click",n)}function n(e){return new Ve(t).catch(function(){if(--e>0)return new Ve(function(t,e){return setTimeout(t,500)}).then(function(){return n(e)});console.log("Failed to get controllers")})}return altspace.inClient?new Ve(t).catch(function(){return new Ve(e)}).then(function(){return n(20)}):Ve.reject()}var o=e(function(t){!function(e){function n(t,e,n,o){var a=e&&e.prototype instanceof i?e:i,s=Object.create(a.prototype),u=new h(o||[]);return s._invoke=function(t,e,n){var i=A;return function(o,a){if(i===M)throw new Error("Generator is already running");if(i===S){if("throw"===o)throw a;return p()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=c(s,n);if(u){if(u===T)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===A)throw i=S,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=M;var l=r(t,e,n);if("normal"===l.type){if(i=n.done?S:x,l.arg===T)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=S,n.method="throw",n.arg=l.arg)}}}(t,n,u),s}function r(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function o(){}function a(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){function e(n,i,o,a){var s=r(t[n],t,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&g.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(c).then(function(t){u.value=t,o(u)},a)}a(s.arg)}var n;this._invoke=function(t,r){function i(){return new Promise(function(n,i){e(t,r,n,i)})}return n=n?n.then(i,i):i()}}function c(t,e){var n=t.iterator[e.method];if(n===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,c(t,e),"throw"===e.method))return T;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var i=r(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,T;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,T):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,T)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function d(t){if(t){var e=t[b];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return r.next=r}}return{next:p}}function p(){return{value:v,done:!0}}var v,y=Object.prototype,g=y.hasOwnProperty,m="function"==typeof Symbol?Symbol:{},b=m.iterator||"@@iterator",w=m.asyncIterator||"@@asyncIterator",_=m.toStringTag||"@@toStringTag",E=e.regeneratorRuntime;if(E)t.exports=E;else{(E=e.regeneratorRuntime=t.exports).wrap=n;var A="suspendedStart",x="suspendedYield",M="executing",S="completed",T={},j={};j[b]=function(){return this};var L=Object.getPrototypeOf,k=L&&L(L(d([])));k&&k!==y&&g.call(k,b)&&(j=k);var O=a.prototype=i.prototype=Object.create(j);o.prototype=O.constructor=a,a.constructor=o,a[_]=o.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(O),t},E.awrap=function(t){return{__await:t}},s(u.prototype),u.prototype[w]=function(){return this},E.AsyncIterator=u,E.async=function(t,e,r,i){var o=new u(n(t,e,r,i));return E.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},s(O),O[_]="Generator",O[b]=function(){return this},O.toString=function(){return"[object Generator]"},E.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},E.values=d,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,T):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;f(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:d(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),T}}}}(function(){return this}()||Function("return this")())}),a=function(){return this}()||Function("return this")(),s=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,u=s&&a.regeneratorRuntime;a.regeneratorRuntime=void 0;var c=o;if(s)a.regeneratorRuntime=u;else try{delete a.regeneratorRuntime}catch(t){a.regeneratorRuntime=void 0}var l=c,f=Math.ceil,h=Math.floor,d=function(t){return isNaN(t=+t)?0:(t>0?h:f)(t)},p=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},v=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),y=e(function(t){var e=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=e)}),g=(y.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),m=function(t,e,n){if(g(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},b=function(t){return"object"==typeof t?null!==t:"function"==typeof t},w=function(t){if(!b(t))throw TypeError(t+" is not an object!");return t},_=function(t){try{return!!t()}catch(t){return!0}},E=!_(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),A=v.document,x=b(A)&&b(A.createElement),M=function(t){return x?A.createElement(t):{}},S=!E&&!_(function(){return 7!=Object.defineProperty(M("div"),"a",{get:function(){return 7}}).a}),T=Object.defineProperty,j={f:E?Object.defineProperty:function(t,e,n){if(w(t),e=function(t,e){if(!b(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!b(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!b(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!b(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),w(n),S)try{return T(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},L=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},k=E?function(t,e,n){return j.f(t,e,L(1,n))}:function(t,e,n){return t[e]=n,t},O="prototype",R=function(t,e,n){var r,i,o,a=t&R.F,s=t&R.G,u=t&R.S,c=t&R.P,l=t&R.B,f=t&R.W,h=s?y:y[e]||(y[e]={}),d=h[O],p=s?v:u?v[e]:(v[e]||{})[O];s&&(n=e);for(r in n)(i=!a&&p&&void 0!==p[r])&&r in h||(o=i?p[r]:n[r],h[r]=s&&"function"!=typeof p[r]?n[r]:l&&i?m(o,v):f&&p[r]==o?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[O]=t[O],e}(o):c&&"function"==typeof o?m(Function.call,o):o,c&&((h.virtual||(h.virtual={}))[r]=o,t&R.R&&d&&!d[r]&&k(d,r,o)))};R.F=1,R.G=2,R.S=4,R.P=8,R.B=16,R.W=32,R.U=64,R.R=128;var F=R,P=k,C={}.hasOwnProperty,D=function(t,e){return C.call(t,e)},B={},N={}.toString,I=function(t){return N.call(t).slice(8,-1)},G=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==I(t)?t.split(""):Object(t)},W=function(t){return G(p(t))},H=Math.min,z=function(t){return t>0?H(d(t),9007199254740991):0},V=Math.max,U=Math.min,q="__core-js_shared__",Q=v[q]||(v[q]={}),J=function(t){return Q[t]||(Q[t]={})},K=0,Y=Math.random(),X=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++K+Y).toString(36))},Z=J("keys"),$=function(t){return Z[t]||(Z[t]=X(t))},tt=function(t){return function(e,n,r){var i,o=W(e),a=z(o.length),s=function(t,e){return(t=d(t))<0?V(t+e,0):U(t,e)}(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}(!1),et=$("IE_PROTO"),nt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),rt=Object.keys||function(t){return function(t,e){var n,r=W(t),i=0,o=[];for(n in r)n!=et&&D(r,n)&&o.push(n);for(;e.length>i;)D(r,n=e[i++])&&(~tt(o,n)||o.push(n));return o}(t,nt)},it=E?Object.defineProperties:function(t,e){w(t);for(var n,r=rt(e),i=r.length,o=0;i>o;)j.f(t,n=r[o++],e[n]);return t},ot=v.document,at=ot&&ot.documentElement,st=$("IE_PROTO"),ut=function(){},ct="prototype",lt=function(){var t,e=M("iframe"),n=nt.length;for(e.style.display="none",at.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),lt=t.F;n--;)delete lt[ct][nt[n]];return lt()},ft=Object.create||function(t,e){var n;return null!==t?(ut[ct]=w(t),n=new ut,ut[ct]=null,n[st]=t):n=lt(),void 0===e?n:it(n,e)},ht=e(function(t){var e=J("wks"),n=v.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:X)("Symbol."+t))}).store=e}),dt=j.f,pt=ht("toStringTag"),vt=function(t,e,n){t&&!D(t=n?t:t.prototype,pt)&&dt(t,pt,{configurable:!0,value:e})},yt={};k(yt,ht("iterator"),function(){return this});var gt=function(t){return Object(p(t))},mt=$("IE_PROTO"),bt=Object.prototype,wt=Object.getPrototypeOf||function(t){return t=gt(t),D(t,mt)?t[mt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?bt:null},_t=ht("iterator"),Et=!([].keys&&"next"in[].keys()),At="values",xt=function(){return this},Mt=function(t,e,n,r,i,o,a){!function(t,e,n){t.prototype=ft(yt,{next:L(1,n)}),vt(t,e+" Iterator")}(n,e,r);var s,u,c,l=function(t){if(!Et&&t in p)return p[t];switch(t){case"keys":case At:return function(){return new n(this,t)}}return function(){return new n(this,t)}},f=e+" Iterator",h=i==At,d=!1,p=t.prototype,v=p[_t]||p["@@iterator"]||i&&p[i],y=!Et&&v||l(i),g=i?h?l("entries"):y:void 0,m="Array"==e?p.entries||v:v;if(m&&(c=wt(m.call(new t)))!==Object.prototype&&c.next&&vt(c,f,!0),h&&v&&v.name!==At&&(d=!0,y=function(){return v.call(this)}),a&&(Et||d||!p[_t])&&k(p,_t,y),B[e]=y,B[f]=xt,i)if(s={values:h?y:l(At),keys:o?y:l("keys"),entries:g},a)for(u in s)u in p||P(p,u,s[u]);else F(F.P+F.F*(Et||d),e,s);return s},St=function(t){return function(e,n){var r,i,o=String(p(e)),a=d(n),s=o.length;return a<0||a>=s?t?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}(!0);Mt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=St(e,n),this._i+=t.length,{value:t,done:!1})});var Tt=function(t,e){return{value:e,done:!!t}};Mt(Array,"Array",function(t,e){this._t=W(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Tt(1)):"keys"==e?Tt(0,n):"values"==e?Tt(0,t[n]):Tt(0,[n,t[n]])},"values");B.Arguments=B.Array;for(var jt=ht("toStringTag"),Lt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),kt=0;kt<Lt.length;kt++){var Ot=Lt[kt],Rt=v[Ot],Ft=Rt&&Rt.prototype;Ft&&!Ft[jt]&&k(Ft,jt,Ot),B[Ot]=B.Array}var Pt,Ct,Dt,Bt=ht("toStringTag"),Nt="Arguments"==I(function(){return arguments}()),It=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Bt))?n:Nt?I(e):"Object"==(r=I(e))&&"function"==typeof e.callee?"Arguments":r},Gt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Wt=function(t,e,n,r){try{return r?e(w(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&w(i.call(t)),e}},Ht=ht("iterator"),zt=Array.prototype,Vt=function(t){return void 0!==t&&(B.Array===t||zt[Ht]===t)},Ut=ht("iterator"),qt=y.getIteratorMethod=function(t){if(void 0!=t)return t[Ut]||t["@@iterator"]||B[It(t)]},Qt=e(function(t){var e={},n={},r=t.exports=function(t,r,i,o,a){var s,u,c,l,f=a?function(){return t}:qt(t),h=m(i,o,r?2:1),d=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(Vt(f)){for(s=z(t.length);s>d;d++)if((l=r?h(w(u=t[d])[0],u[1]):h(t[d]))===e||l===n)return l}else for(c=f.call(t);!(u=c.next()).done;)if((l=Wt(c,h,u.value,r))===e||l===n)return l};r.BREAK=e,r.RETURN=n}),Jt=ht("species"),Kt=function(t,e){var n,r=w(t).constructor;return void 0===r||void 0==(n=w(r)[Jt])?e:g(n)},Yt=v.process,Xt=v.setImmediate,Zt=v.clearImmediate,$t=v.MessageChannel,te=v.Dispatch,ee=0,ne={},re="onreadystatechange",ie=function(){var t=+this;if(ne.hasOwnProperty(t)){var e=ne[t];delete ne[t],e()}},oe=function(t){ie.call(t.data)};Xt&&Zt||(Xt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return ne[++ee]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Pt(ee),ee},Zt=function(t){delete ne[t]},"process"==I(Yt)?Pt=function(t){Yt.nextTick(m(ie,t,1))}:te&&te.now?Pt=function(t){te.now(m(ie,t,1))}:$t?(Dt=(Ct=new $t).port2,Ct.port1.onmessage=oe,Pt=m(Dt.postMessage,Dt,1)):v.addEventListener&&"function"==typeof postMessage&&!v.importScripts?(Pt=function(t){v.postMessage(t+"","*")},v.addEventListener("message",oe,!1)):Pt=re in M("script")?function(t){at.appendChild(M("script"))[re]=function(){at.removeChild(this),ie.call(t)}}:function(t){setTimeout(m(ie,t,1),0)});var ae={set:Xt,clear:Zt},se=ae.set,ue=v.MutationObserver||v.WebKitMutationObserver,ce=v.process,le=v.Promise,fe="process"==I(ce),he={f:function(t){return new function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=g(e),this.reject=g(n)}(t)}},de=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},pe=function(t,e){if(w(t),b(e)&&e.constructor===t)return e;var n=he.f(t);return(0,n.resolve)(e),n.promise},ve=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:k(t,r,e[r]);return t},ye=ht("species"),ge=function(t){var e="function"==typeof y[t]?y[t]:v[t];E&&e&&!e[ye]&&j.f(e,ye,{configurable:!0,get:function(){return this}})},me=ht("iterator"),be=!1;try{[7][me]().return=function(){be=!0}}catch(t){}var we,_e,Ee,Ae,xe=function(t,e){if(!e&&!be)return!1;var n=!1;try{var r=[7],i=r[me]();i.next=function(){return{done:n=!0}},r[me]=function(){return i},t(r)}catch(t){}return n},Me=ae.set,Se=function(){var t,e,n,r=function(){var r,i;for(fe&&(r=ce.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(fe)n=function(){ce.nextTick(r)};else if(!ue||v.navigator&&v.navigator.standalone)if(le&&le.resolve){var i=le.resolve();n=function(){i.then(r)}}else n=function(){se.call(v,r)};else{var o=!0,a=document.createTextNode("");new ue(r).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(r){var i={fn:r,next:void 0};e&&(e.next=i),t||(t=i,n()),e=i}}(),Te="Promise",je=v.TypeError,Le=v.process,ke=v[Te],Oe="process"==It(Le),Re=function(){},Fe=_e=he.f,Pe=!!function(){try{var t=ke.resolve(1),e=(t.constructor={})[ht("species")]=function(t){t(Re,Re)};return(Oe||"function"==typeof PromiseRejectionEvent)&&t.then(Re)instanceof e}catch(t){}}(),Ce=function(t){var e;return!(!b(t)||"function"!=typeof(e=t.then))&&e},De=function(t,e){if(!t._n){t._n=!0;var n=t._c;Se(function(){for(var r=t._v,i=1==t._s,o=0,a=function(e){var n,o,a=i?e.ok:e.fail,s=e.resolve,u=e.reject,c=e.domain;try{a?(i||(2==t._h&&Ie(t),t._h=1),!0===a?n=r:(c&&c.enter(),n=a(r),c&&c.exit()),n===e.promise?u(je("Promise-chain cycle")):(o=Ce(n))?o.call(n,s,u):s(n)):u(r)}catch(t){u(t)}};n.length>o;)a(n[o++]);t._c=[],t._n=!1,e&&!t._h&&Be(t)})}},Be=function(t){Me.call(v,function(){var e,n,r,i=t._v,o=Ne(t);if(o&&(e=de(function(){Oe?Le.emit("unhandledRejection",i,t):(n=v.onunhandledrejection)?n({promise:t,reason:i}):(r=v.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=Oe||Ne(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},Ne=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ie=function(t){Me.call(v,function(){var e;Oe?Le.emit("rejectionHandled",t):(e=v.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ge=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),De(e,!0))},We=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw je("Promise can't be resolved itself");(e=Ce(t))?Se(function(){var r={_w:n,_d:!1};try{e.call(t,m(We,r,1),m(Ge,r,1))}catch(t){Ge.call(r,t)}}):(n._v=t,n._s=1,De(n,!1))}catch(t){Ge.call({_w:n,_d:!1},t)}}};Pe||(ke=function(t){Gt(this,ke,Te,"_h"),g(t),we.call(this);try{t(m(We,this,1),m(Ge,this,1))}catch(t){Ge.call(this,t)}},(we=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ve(ke.prototype,{then:function(t,e){var n=Fe(Kt(this,ke));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Oe?Le.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&De(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Ee=function(){var t=new we;this.promise=t,this.resolve=m(We,t,1),this.reject=m(Ge,t,1)},he.f=Fe=function(t){return t===ke||t===Ae?new Ee(t):_e(t)}),F(F.G+F.W+F.F*!Pe,{Promise:ke}),vt(ke,Te),ge(Te),Ae=y[Te],F(F.S+F.F*!Pe,Te,{reject:function(t){var e=Fe(this);return(0,e.reject)(t),e.promise}}),F(F.S+!0*F.F,Te,{resolve:function(t){return pe(this===Ae?ke:this,t)}}),F(F.S+F.F*!(Pe&&xe(function(t){ke.all(t).catch(Re)})),Te,{all:function(t){var e=this,n=Fe(e),r=n.resolve,i=n.reject,o=de(function(){var n=[],o=0,a=1;Qt(t,!1,function(t){var s=o++,u=!1;n.push(void 0),a++,e.resolve(t).then(function(t){u||(u=!0,n[s]=t,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(t){var e=this,n=Fe(e),r=n.reject,i=de(function(){Qt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}}),F(F.P+F.R,"Promise",{finally:function(t){var e=Kt(this,y.Promise||v.Promise),n="function"==typeof t;return this.then(n?function(n){return pe(e,t()).then(function(){return n})}:t,n?function(n){return pe(e,t()).then(function(){throw n})}:t)}}),F(F.S,"Promise",{try:function(t){var e=he.f(this),n=de(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var He=y.Promise,ze=e(function(t){t.exports={default:He,__esModule:!0}}),Ve=t(ze),Ue=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(ze);e.default=function(t){return function(){var e=t.apply(this,arguments);return new n.default(function(t,r){function i(o,a){try{var s=e[o](a),u=s.value}catch(t){return void r(t)}if(!s.done)return n.default.resolve(u).then(function(t){i("next",t)},function(t){i("throw",t)});t(u)}return i("next")})}}}));AFRAME.registerComponent("place-for-space",{schema:{templates:{default:[]},mixins:{default:[]},otherwise:{default:""}},init:function(){var t=Ue(l.mark(function t(){var e,n;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!altspace.inClient){t.next=6;break}return t.next=3,altspace.getSpace();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0={};case 7:e=t.t0,console.log(e),(n=this.data.templates.indexOf(e.templateSid))>=0?this.el.setAttribute("mixin",this.data.mixins[n]):this.el.setAttribute("mixin",this.data.otherwise);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-page",{schema:{service:{type:"string",default:"poly"},page:{type:"int",default:0}},update:function(){var t=Ue(l.mark(function t(e){var n;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.el.emit("pageupdatestart"),t.prev=1,n=this.el.sceneEl.hasAttribute("debug")?"fakeGetListing":"getListing",t.next=5,this.el.sceneEl.systems[this.data.service+"-service"][n](this.data.page);case 5:this.currentPage=t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0.stack);case 11:this.el.emit("pageupdateend");case 12:case"end":return t.stop()}},t,this,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-item",{schema:{type:"int"},init:function(){this.itemData=null,this.el.parentElement.addEventListener("pageupdatestart",this.showLoading.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updateContents.bind(this)),this.el.addEventListener("materialtextureloaded",this.updateDimensions.bind(this)),this.el.addEventListener("click",this.previewModel.bind(this))},showLoading:function(){this.el.setAttribute("color","#555")},updateContents:function(){this.itemData=this.el.parentElement.components["library-page"].currentPage.assets[this.data],this.itemData&&this.el.setAttribute("src",this.itemData.thumbnail.url)},updateDimensions:function(){var t=this.el.object3DMap.mesh.material.map,e=t&&t.image&&"IMG"===t.image.tagName?t.image:{width:1,height:1},n=e.width/e.height;n>1?this.el.setAttribute("scale",{x:1,y:1/n,z:1}):this.el.setAttribute("scale",{x:n,y:1,z:1}),this.itemData&&this.el.setAttribute("color","#fff")},previewModel:function(){var t=document.querySelector("#spawn"),e=this.itemData.formats.filter(function(t){return"GLTF2"===t.formatType});t.setAttribute("src",e[0].root.url)}}),AFRAME.registerComponent("library-advance",{schema:{type:"int"},init:function(){this.active=!1,this.el.addEventListener("click",this.advance.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updatePaging.bind(this))},advance:function(){if(this.active){var t=this.el.parentElement,e=t.getAttribute("library-page").page;t.setAttribute("library-page","page",e+this.data)}},updatePaging:function(){var t=this.el.parentElement.components["library-page"];this.el.sceneEl.systems["poly-service"].pages[t.data.page+this.data]||this.data>0&&t.currentPage.nextPageToken?(this.el.setAttribute("avr-visible",!0),this.active=!0,console.log("advance "+this.data+": shown")):(this.el.setAttribute("avr-visible",!1),this.active=!1,console.log("advance "+this.data+": hidden"))}});var qe=y.getIterator=function(t){var e=qt(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return w(e.call(t))},Qe=e(function(t){t.exports={default:qe,__esModule:!0}}),Je=t(Qe),Ke=e(function(t){var e=X("meta"),n=j.f,r=0,i=Object.isExtensible||function(){return!0},o=!_(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!b(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!D(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!D(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!D(t,e)&&a(t),t}}}),Ye=(Ke.KEY,Ke.NEED,Ke.fastKey,Ke.getWeak,Ke.onFreeze,function(t,e){if(!b(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}),Xe=j.f,Ze=Ke.fastKey,$e=E?"_s":"size",tn=function(t,e){var n,r=Ze(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n},en={getConstructor:function(t,e,n,r){var i=t(function(t,o){Gt(t,i,e,"_i"),t._t=e,t._i=ft(null),t._f=void 0,t._l=void 0,t[$e]=0,void 0!=o&&Qt(o,n,t[r],t)});return ve(i.prototype,{clear:function(){for(var t=Ye(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[$e]=0},delete:function(t){var n=Ye(this,e),r=tn(n,t);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[$e]--}return!!r},forEach:function(t){Ye(this,e);for(var n,r=m(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!tn(Ye(this,e),t)}}),E&&Xe(i.prototype,"size",{get:function(){return Ye(this,e)[$e]}}),i},def:function(t,e,n){var r,i,o=tn(t,e);return o?o.v=n:(t._l=o={i:i=Ze(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=o),r&&(r.n=o),t[$e]++,"F"!==i&&(t._i[i]=o)),t},getEntry:tn,setStrong:function(t,e,n){Mt(t,e,function(t,n){this._t=Ye(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?"keys"==t?Tt(0,e.k):"values"==t?Tt(0,e.v):Tt(0,[e.k,e.v]):(this._t=void 0,Tt(1))},n?"entries":"values",!n,!0),ge(e)}},nn=Array.isArray||function(t){return"Array"==I(t)},rn=ht("species"),on=function(t,e){return new(function(t){var e;return nn(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!nn(e.prototype)||(e=void 0),b(e)&&null===(e=e[rn])&&(e=void 0)),void 0===e?Array:e}(t))(e)},an=j.f,sn=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,u=e||on;return function(e,c,l){for(var f,h,d=gt(e),p=G(d),v=m(c,l,3),y=z(p.length),g=0,b=n?u(e,y):r?u(e,0):void 0;y>g;g++)if((s||g in p)&&(f=p[g],h=v(f,g,d),t))if(n)b[g]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return g;case 2:b.push(f)}else if(o)return!1;return a?-1:i||o?o:b}}(0),un=function(t,e,n,r,i,o){var a=v[t],s=a,u=i?"set":"add",c=s&&s.prototype,l={};return E&&"function"==typeof s&&(o||c.forEach&&!_(function(){(new s).entries().next()}))?(s=e(function(e,n){Gt(e,s,t,"_c"),e._c=new a,void 0!=n&&Qt(n,i,e[u],e)}),sn("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in c&&(!o||"clear"!=t)&&k(s.prototype,t,function(n,r){if(Gt(this,s,t),!e&&o&&!b(n))return"get"==t&&void 0;var i=this._c[t](0===n?0:n,r);return e?this:i})}),o||an(s.prototype,"size",{get:function(){return this._c.size}})):(s=r.getConstructor(e,t,i,u),ve(s.prototype,n),Ke.NEED=!0),vt(s,t),l[t]=s,F(F.G+F.W+F.F,l),o||r.setStrong(s,t,i),s},cn=(un("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return en.def(Ye(this,"Set"),t=0===t?0:t,t)}},en),function(t){return function(){if(It(this)!=t)throw TypeError(t+"#toJSON isn't generic");return function(t,e){var n=[];return Qt(t,!1,n.push,n,e),n}(this)}});F(F.P+F.R,"Set",{toJSON:cn("Set")});var ln=function(t){F(F.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})};ln("Set");var fn=function(t){F(F.S,t,{from:function(t){var e,n,r,i,o=arguments[1];return g(this),(e=void 0!==o)&&g(o),void 0==t?new this:(n=[],e?(r=0,i=m(o,arguments[2],2),Qt(t,!1,function(t){n.push(i(t,r++))})):Qt(t,!1,n.push,n),new this(n))}})};fn("Set");var hn=y.Set,dn=t(e(function(t){t.exports={default:hn,__esModule:!0}}));AFRAME.registerSystem("poly-service",{schema:{key:{type:"string"}},init:function(){this.pages=[],this.loader=new AFRAME.THREE.FileLoader,this.query="https://poly.googleapis.com/v1/assets/?format=GLTF2&maxComplexity=SIMPLE&pageSize=20&key="+this.data.key},getListing:function(){var t=Ue(l.mark(function t(e){var r,i,o,a,s;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("attemping grab of page",e),!(e<0)){t.next=3;break}throw new Error("Requested page ("+e+") before beginning");case 3:if(!this.pages[e]){t.next=7;break}return t.abrupt("return",this.pages[e]);case 7:if(0!==e){t.next=16;break}return t.next=10,n(this.query,this.loader);case 10:return r=t.sent,i=JSON.parse(r),this.pages.push(i),t.abrupt("return",i);case 16:return o={},t.prev=17,t.next=20,this.getListing(e-1);case 20:o=t.sent,t.next=27;break;case 23:throw t.prev=23,t.t0=t.catch(17),console.log(t.t0.stack),new Error("Requested page ("+e+") past end, no previous page");case 27:if(!o.nextPageToken){t.next=36;break}return t.next=30,n(this.query+"&pageToken="+o.nextPageToken,this.loader);case 30:return a=t.sent,s=JSON.parse(a),this.pages.push(s),t.abrupt("return",s);case 36:throw new Error("Requested page ("+e+") past end, no page token");case 37:case"end":return t.stop()}},t,this,[[17,23]])}));return function(e){return t.apply(this,arguments)}}(),fakeGetListing:function(){var t=Ue(l.mark(function t(e){var r;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n("testdata/listing.json",this.loader);case 2:return r=t.sent,t.abrupt("return",JSON.parse(r));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("avr-visible",{schema:{type:"boolean",default:!1},init:function(){this.el.addEventListener("model-loaded",this.update.bind(this))},update:function(){var t=this;console.log("visible update:",this.data),this.el.object3D.traverse(function(e){return e.visible=t.data})}});AFRAME.registerComponent("hover-scale",{init:function(){var t=this;this.el.setAttribute("animation__hover",{startEvents:["hoverstart","mouseleave"],property:"scale",dir:"alternate",easing:"easeOutQuad",dur:200}),this.el.addEventListener("mouseenter",function(){var e=function(t,e){return e.map(function(e){return t[e]})}(t.el.getAttribute("scale"),["x","y","z"]),n=e.map(function(t){return 1.2*t});t.el.setAttribute("animation__hover",{from:e.join(" "),to:n.join(" ")}),t.el.emit("hoverstart")})}}),AFRAME.registerComponent("maintain-size",{schema:{type:"vec3"},init:function(){this.el.addEventListener("model-loaded",this.rescale.bind(this))},rescale:function(){this.el.setAttribute("position",{x:0,y:0,z:0}),this.el.setAttribute("scale",{x:1,y:1,z:1});var t=new AFRAME.THREE.Box3;t.setFromObject(this.el.object3D);var e=t.getSize(),n=this.el.object3D.worldToLocal(t.getCenter()),r=Math.min(this.data.x/e.x,this.data.y/e.y,this.data.z/e.z);this.el.setAttribute("scale",{x:r,y:r,z:r}),this.el.setAttribute("position",n.multiplyScalar(-r)),this.el.components.collision&&this.el.components.collision.updateTransform()}});var pn=[],vn=null;AFRAME.registerComponent("altspace-controls",{schema:{default:"right"},init:function(){var t=Ue(l.mark(function t(){var e,n=this;return l.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.gamepad=null,this.parentInverse=(new THREE.Matrix4).getInverse(this.el.parentElement.object3D.matrixWorld),vn||(vn=i()),!(pn.length>0)){t.next=7;break}t.t0=pn,t.next=10;break;case 7:return t.next=9,vn;case 9:t.t0=t.sent;case 10:e=t.t0,this.gamepad=e.filter(function(t){return t.hand===n.data})[0],this.gamepad||console.log("No "+this.data+"-hand controller found");case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tick:function(){this.gamepad&&(this.el.object3D.position.copy(this.gamepad.position).applyMatrix4(this.parentInverse),this.el.object3D.quaternion.copy(this.gamepad.rotation),!this.gripState&&this.gamepad.buttons[1].pressed?(this.gripState=!0,this.el.emit("gripdown",this.el,!1)):this.gripState&&!this.gamepad.buttons[1].pressed&&(this.gripState=!1,this.el.emit("gripup",this.el,!1)))}}),AFRAME.registerComponent("grabbable",{schema:{enabled:{default:!0},dropTarget:{type:"selector",default:"#decorations"}},init:function(){this._hoverStart=this.hoverStart.bind(this),this._pickup=this.pickup.bind(this),this._drop=this.drop.bind(this),this._hoverEnd=this.hoverEnd.bind(this),this.el.dataset.spawned&&(this.el.parentElement.addEventListener("gripup",this._drop),this.el.removeAttribute("data-spawned"))},update:function(){this.data.enabled?(this.el.addEventListener("collision-start",this._hoverStart),this.el.addEventListener("collision-end",this._hoverEnd)):(this.el.removeEventListener("collision-start",this._hoverStart),this.el.removeEventListener("collision-end",this._hoverEnd))},hoverStart:function(t){t.detail.addEventListener("gripdown",this._pickup)},pickup:function(t){t.detail;this.el.addEventListener("gripup",this._drop)},drop:function(t){t.detail;this.data.dropTarget.object3D.updateMatrixWorld(!0),this.el.object3D.updateMatrixWorld(!0);var e=(new AFRAME.THREE.Matrix4).getInverse(this.data.dropTarget.object3D.matrixWorld).multiply(this.el.object3D.matrixWorld),n=new AFRAME.THREE.Vector3,r=new AFRAME.THREE.Quaternion,i=new AFRAME.THREE.Euler,o=new AFRAME.THREE.Vector3;e.decompose(n,r,o),i.setFromQuaternion(r),i=i.toVector3().multiplyScalar(180/Math.PI),this.el.setAttribute("position",n),this.el.setAttribute("rotation",i),this.el.setAttribute("scale",o),this.data.dropTarget.appendChild(this.el),this.el.setAttribute("collision","kinematic",!1),console.log("drop finished")},hoverEnd:function(t){t.detail.removeEventListener("gripdown",this._pickup)}});var yn=function(t,e,n){e in t?j.f(t,e,L(0,n)):t[e]=n};F(F.S+F.F*!xe(function(t){}),"Array",{from:function(t){var e,n,r,i,o=gt(t),a="function"==typeof this?this:Array,s=arguments.length,u=s>1?arguments[1]:void 0,c=void 0!==u,l=0,f=qt(o);if(c&&(u=m(u,s>2?arguments[2]:void 0,2)),void 0==f||a==Array&&Vt(f))for(n=new a(e=z(o.length));e>l;l++)yn(n,l,c?u(o[l],l):o[l]);else for(i=f.call(o),n=new a;!(r=i.next()).done;l++)yn(n,l,c?Wt(i,u,[r.value,l],!0):r.value);return n.length=l,n}});var gn=y.Array.from,mn=e(function(t){t.exports={default:gn,__esModule:!0}});t(mn);var bn=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(mn);e.default=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return(0,n.default)(t)}})),wn=ht("iterator"),_n=y.isIterable=function(t){var e=Object(t);return void 0!==e[wn]||"@@iterator"in e||B.hasOwnProperty(It(e))},En=e(function(t){t.exports={default:_n,__esModule:!0}});t(En);var An=t(e(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(En),i=n(Qe);e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,r.default)(Object(t)))return function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var s,u=(0,i.default)(t);!(r=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}));un("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=en.getEntry(Ye(this,"Map"),t);return e&&e.v},set:function(t,e){return en.def(Ye(this,"Map"),0===t?0:t,e)}},en,!0);F(F.P+F.R,"Map",{toJSON:cn("Map")}),ln("Map"),fn("Map");var xn=y.Map,Mn=t(e(function(t){t.exports={default:xn,__esModule:!0}})),Sn=t(e(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}));F(F.S+F.F*!E,"Object",{defineProperty:j.f});var Tn=y.Object,jn=function(t,e,n){return Tn.defineProperty(t,e,n)},Ln=e(function(t){t.exports={default:jn,__esModule:!0}});t(Ln);var kn=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(Ln);e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(t,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()})),On=function(){function t(){Sn(this,t),this.aToB=new Mn,this.bToA=new Mn}return kn(t,[{key:"set",value:function(t,e){var n=this.bToA.get(e),r=this.aToB.get(t);n===t&&r===e||(this.aToB.delete(n),this.bToA.delete(r)),this.aToB.set(t,e),this.bToA.set(e,t)}},{key:"getB",value:function(t){return this.aToB.get(t)}},{key:"getA",value:function(t){return this.bToA.get(t)}},{key:"forEach",value:function(t){return this.bToA.forEach(t)}},{key:"deleteA",value:function(t){this.aToB.get(t)&&(this.bToA.delete(this.aToB.get(t)),this.aToB.delete(t))}},{key:"deleteB",value:function(t){this.bToA.get(t)&&(this.aToB.delete(this.bToA.get(t)),this.bToA.delete(t))}}]),t}(),Rn=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),Fn=e(function(t){var e=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=e)}),Pn=(Fn.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),Cn=function(t){if(!Pn(t))throw TypeError(t+" is not an object!");return t},Dn=function(t){try{return!!t()}catch(t){return!0}},Bn=!Dn(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Nn=Rn.document,In=Pn(Nn)&&Pn(Nn.createElement),Gn=!Bn&&!Dn(function(){return 7!=Object.defineProperty(function(t){return In?Nn.createElement(t):{}}("div"),"a",{get:function(){return 7}}).a}),Wn=Object.defineProperty,Hn={f:Bn?Object.defineProperty:function(t,e,n){if(Cn(t),e=function(t,e){if(!Pn(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!Pn(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!Pn(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!Pn(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),Cn(n),Gn)try{return Wn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},zn=Bn?function(t,e,n){return Hn.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},Vn={}.hasOwnProperty,Un=function(t,e){return Vn.call(t,e)},qn=0,Qn=Math.random(),Jn=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++qn+Qn).toString(36))},Kn=e(function(t){var e=Jn("src"),n=Function.toString,r=(""+n).split("toString");Fn.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,o){var a="function"==typeof i;a&&(Un(i,"name")||zn(i,"name",n)),t[n]!==i&&(a&&(Un(i,e)||zn(i,e,t[n]?""+t[n]:r.join(String(n)))),t===Rn?t[n]=i:o?t[n]?t[n]=i:zn(t,n,i):(delete t[n],zn(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||n.call(this)})}),Yn=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},Xn=function(t,e,n){var r,i,o,a,s=t&Xn.F,u=t&Xn.G,c=t&Xn.S,l=t&Xn.P,f=t&Xn.B,h=u?Rn:c?Rn[e]||(Rn[e]={}):(Rn[e]||{}).prototype,d=u?Fn:Fn[e]||(Fn[e]={}),p=d.prototype||(d.prototype={});u&&(n=e);for(r in n)o=((i=!s&&h&&void 0!==h[r])?h:n)[r],a=f&&i?Yn(o,Rn):l&&"function"==typeof o?Yn(Function.call,o):o,h&&Kn(h,r,o,t&Xn.U),d[r]!=o&&zn(d,r,a),l&&p[r]!=o&&(p[r]=o)};Rn.core=Fn,Xn.F=1,Xn.G=2,Xn.S=4,Xn.P=8,Xn.B=16,Xn.W=32,Xn.U=64,Xn.R=128;var Zn=Xn,$n={}.toString,tr=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return $n.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},er=function(t){return tr(function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}(t))},nr=Math.ceil,rr=Math.floor,ir=function(t){return isNaN(t=+t)?0:(t>0?rr:nr)(t)},or=Math.min,ar=Math.max,sr=Math.min,ur="__core-js_shared__",cr=Rn[ur]||(Rn[ur]={}),lr=e(function(t){var e=function(t){return cr[t]||(cr[t]={})}("wks"),n=Rn.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:Jn)("Symbol."+t))}).store=e})("unscopables"),fr=Array.prototype;void 0==fr[lr]&&zn(fr,lr,{});var hr=function(t){return function(e,n,r){var i,o=er(e),a=function(t){return t>0?or(ir(t),9007199254740991):0}(o.length),s=function(t,e){return(t=ir(t))<0?ar(t+e,0):sr(t,e)}(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}(!0);Zn(Zn.P,"Array",{includes:function(t){return hr(this,t,arguments.length>1?arguments[1]:void 0)}}),function(t){fr[lr][t]=!0}("includes");Fn.Array.includes;var dr=function(){function t(){Sn(this,t),this._pools={},this._refs=new Mn}return kn(t,[{key:"get",value:function(t){this._pools[t]=this._pools[t]||[];var e=this._pools[t].shift()||new Ammo[t];return this._refs.set(e,t),e}},{key:"getSome",value:function(t,e){for(var n=[],r=0;r<e;r++)n.push(this.get(t));return n}},{key:"done",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(e){var n=t._refs.get(e);t._pools[n]=t._pools[n]||[],t._pools[n].push(e)})}}]),t}();AFRAME.registerSystem("collision",{init:function(){var t=this;this.el2co=new On,this.el2localBounds=new Mn,this.regQueue=[],this.manifolds=new dn,this.forceUpdateObjects=new dn,this._debugMeshes=new Mn,this.ap=new dr,Ammo().then(function(){var e=new Ammo.btDefaultCollisionConfiguration,n=new Ammo.btCollisionDispatcher(e),r=t.ap.getSome("btVector3",2),i=An(r,2),o=i[0],a=i[1];o.setValue(-100,-100,-100),a.setValue(100,100,100);var s=new Ammo.btAxisSweep3(o,a);t.world=new Ammo.btCollisionWorld(n,s,e),t.ap.done(o,a),t.regQueue.forEach(function(e){return t.registerCollisionBody(e)}),t.regQueue=null})},tick:function(){var t=this;if(this.world){this.el2co.forEach(function(e,n){try{if(!t.forceUpdateObjects.has(e)&&!e.getAttribute("collision").kinematic)return;e.object3D.updateMatrixWorld(!0);var r=t.el2localBounds.get(e),i=e.object3D.localToWorld(r.getCenter()),o=e.object3D.getWorldQuaternion(),a=e.object3D.getWorldScale(),s=n.getWorldTransform(),u=n.getCollisionShape(),c=t.ap.getSome("btVector3",2),l=An(c,2),f=l[0],h=l[1],d=t.ap.get("btQuaternion");if(f.setValue.apply(f,bn(i.toArray())),d.setValue.apply(d,bn(o.toArray())),h.setValue.apply(h,bn(a.toArray())),s.setOrigin(f),s.setRotation(d),u.setLocalScaling(h),t.ap.done(f,d,h),t.forceUpdateObjects.delete(e),t.el.sceneEl.hasAttribute("debug")&&t._debugMeshes.has(e)){var p=t._debugMeshes.get(e);p.position.copy(i),p.quaternion.copy(o),p.scale.copy(a)}}catch(t){console.error("xfrm update failed:",err,e)}}),this.world.performDiscreteCollisionDetection();for(var e=this.world.getDispatcher(),n=e.getNumManifolds(),i=new dn,o=0;o<n;o++){var a=e.getManifoldByIndexInternal(o);i.add(a)}try{var s=r(i,this.manifolds),u=!0,c=!1,l=void 0;try{for(var f,h=Je(s);!(u=(f=h.next()).done);u=!0){var d=f.value,p=d.getBody0(),v=d.getBody1(),y=this.el2co.getA(p),g=this.el2co.getA(v);if(y&&g){console.log(y.getAttribute("collision").with,g.getAttribute("collision").with);var m=y.getAttribute("collision").with,b=g.getAttribute("collision").with;m.includes(g)&&b.includes(y)&&(console.log("collision start"),g.emit("collision-start",y,!1),y.emit("collision-start",g,!1))}}}catch(t){c=!0,l=t}finally{try{!u&&h.return&&h.return()}finally{if(c)throw l}}}catch(t){console.error("coll-start failed:",t)}try{var w=r(this.manifolds,i),_=!0,E=!1,A=void 0;try{for(var x,M=Je(w);!(_=(x=M.next()).done);_=!0){var S=x.value,T=S.getBody0(),j=S.getBody1(),L=this.el2co.getA(T),k=this.el2co.getA(j);if(L&&k){var O=[].concat(bn(L.getAttribute("collision").with)),R=[].concat(bn(k.getAttribute("collision").with));O.includes(k)&&R.includes(L)&&(console.log("collision end"),k.emit("collision-end",L,!1),L.emit("collision-end",k,!1))}}}catch(t){E=!0,A=t}finally{try{!_&&M.return&&M.return()}finally{if(E)throw A}}}catch(t){console.error("coll-start failed:",t)}this.manifolds=i}},registerCollisionBody:function(t){if(this.world){var e=new AFRAME.THREE.Box3;e.setFromObject(t.object3DMap.mesh);var n=(new THREE.Matrix4).getInverse(t.object3D.matrixWorld);e.applyMatrix4(n),this.el2localBounds.set(t,e);var r=e.getSize(),i=new Ammo.btVector3(r.x/2,r.y/2,r.z/2),o=new Ammo.btCollisionObject;if(o.setCollisionShape(new Ammo.btBoxShape(i)),this.el2co.set(t,o),this.world.addCollisionObject(o),this.el.sceneEl.hasAttribute("debug")){var a=new THREE.Mesh(new THREE.BoxBufferGeometry(r.x,r.y,r.z),new THREE.MeshBasicMaterial({color:"magenta",transparent:!0,opacity:.2}));this._debugMeshes.set(t,a),this.el.sceneEl.object3D.add(a)}}else this.regQueue.push(t)},removeCollisionBody:function(t){var e=this.el2co.getB(t);this.world.removeCollisionObject(e),this.el2co.deleteA(t),this.el.sceneEl.hasAttribute("debug")&&(this.el.sceneEl.object3D.remove(this._debugMeshes.get(t)),this._debugMeshes.delete(t))},isRegistered:function(t){return!!this.el2co.getB(t)},forceUpdateTransform:function(t){this.forceUpdateObjects.add(t)}}),AFRAME.registerComponent("collision",{schema:{with:{type:"selectorAll"},kinematic:{type:"boolean",default:!1}},init:function(){this.el.object3DMap.mesh&&this.updateBounds(),this.el.addEventListener("model-loaded",this.updateBounds.bind(this))},update:function(t){t.kinematic&&!this.data.kinematic&&this.system.forceUpdateTransform(this.el)},updateBounds:function(){this.system.isRegistered(this.el)&&this.system.removeCollisionBody(this.el),this.system.registerCollisionBody(this.el),this.updateTransform()},updateTransform:function(){this.system.forceUpdateTransform(this.el)},remove:function(){this.system.removeCollisionBody(this.el)}}),AFRAME.registerComponent("grab-indicator",{init:function(){var t=this;this.el.setAttribute("color","white"),this.el.addEventListener("collision-start",function(){t.el.setAttribute("color","yellow")}),this.el.addEventListener("collision-end",function(){t.el.setAttribute("color","white")})}}),AFRAME.registerComponent("spawner",{schema:{enabled:{default:!0},spawnTarget:{type:"selector",default:"#decorations"}},init:function(){this._hoverStart=this.hoverStart.bind(this),this._hoverEnd=this.hoverEnd.bind(this),this.handlers=new Mn},update:function(){if(this.data.enabled)this.el.addEventListener("collision-start",this._hoverStart),this.el.addEventListener("collision-end",this._hoverEnd);else{this.el.removeEventListener("collision-start",this._hoverStart),this.el.removeEventListener("collision-end",this._hoverEnd);var t=!0,e=!1,n=void 0;try{for(var r,i=Je(this.handlers);!(t=(r=i.next()).done);t=!0){var o=r.value,a=An(o,2),s=a[0];a[1];this.hoverEnd({detail:s})}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},hoverStart:function(t){var e=t.detail,n=this.spawn(e);this.handlers.set(e,n),e.addEventListener("gripdown",n)},spawn:function(t){var e=this;return function(){var n=document.createElement("a-entity");n.classList.add("decoration"),n.setAttribute("mixin","model"),n.setAttribute("data-src",e.el.getAttribute("gltf-model")),n.setAttribute("data-spawned","true"),n.setAttribute("grabbable",{enabled:!1}),n.setAttribute("collision",{with:"#lefthand,#righthand",kinematic:!0}),t.appendChild(n),e.el.object3D.updateMatrixWorld(!0),t.object3D.updateMatrixWorld(!0),console.log("target pos:",t.object3D.getWorldPosition().toArray()),console.log("entity pos:",e.el.object3D.getWorldPosition().toArray());var r=(new AFRAME.THREE.Matrix4).getInverse(t.object3D.matrixWorld).multiply(e.el.object3D.matrixWorld),i=new AFRAME.THREE.Vector3,o=new AFRAME.THREE.Quaternion,a=new AFRAME.THREE.Euler,s=new AFRAME.THREE.Vector3;r.decompose(i,o,s),a.setFromQuaternion(o,"XYZ"),a=a.toVector3().multiplyScalar(180/Math.PI),console.log("relative pos:",i.toArray()),n.setAttribute("position",i),n.setAttribute("rotation",a),n.setAttribute("scale",s),e.el.setAttribute("spawner","enabled",!1)}},hoverEnd:function(t){var e=t.detail;console.log("hover end"),e.removeEventListener("gripdown",this.handlers.get(e)),this.handlers.delete(e),this.el.setAttribute("spawner","enabled",!0)}}),AFRAME.registerComponent("set-from-data",{schema:{from:{type:"string"},to:{type:"array"}},multiple:!0,update:function(){var t;(t=this.el).setAttribute.apply(t,bn(this.data.to).concat([this.el.dataset[this.data.from]]))}})}();
//# sourceMappingURL=bundle.min.js.map
//# sourceMappingURL=bundle.min.js.map
